% siemens star (aka spoke target) focus pattern

% author: Michael Teresi


% NB setting \paperwidth after geometry produced an error
%    where tikz page center was not actually in center of page
%    pass options on command line instead and use `current page.center`


\documentclass{article}

% NB do not set paperwidth, paperheight here b/c they are NOT
%    overridden by the command line options
\usepackage[
	nohead,
	nofoot,
	margin=0mm,
	voffset=0mm,
	hoffset=0mm
]
{geometry}

\usepackage{tikz, ifthen}
\usetikzlibrary{fit, calc}


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% in mm, but don't use units! it messes up TikZ

\newcommand{\width}{86.36}  % business card, 86x53
\newcommand{\height}{53.34} % business card, 86x53

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\setlength{\paperwidth}{\width mm}    % tell LaTeX the units for the page
\setlength{\paperheight}{\height mm}  % tell LaTeX the units for the page

\pgfmathsetmacro\paperW{\width}
\pgfmathsetmacro\paperH{\height}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\begin{document}

% provides input variables
% nSpokes    number of filled sections in the star, aka spoke target, (45)
% radius     radius in mm of the spokes (45% of pagewidth)
\IfFileExists{options}{\input{options}}{}

\ifdefined\nSpokes
\else
	\newcommand\nSpokes{45}  % MAGIC 8deg / spoke appears to be common
\fi

\ifdefined\radius
\else
	% MAGIC user prefence, 90 of page with
	\pgfmathsetmacro\radius{0.499*\width}
\fi


\pgfmathsetmacro\angle{360.0/2/\nSpokes}  % spokes fill *half* the circle
\pgfmathsetmacro\cx{\paperW/2}
\pgfmathsetmacro\cy{\paperH/2}

\begin{tikzpicture}
[%
	x=1mm,
	y=1mm,
	overlay,
	remember picture,
	scale=1,
	radius=\radius,
	delta angle=\angle,
	shift={(current page.south west)}
]
%\draw [help lines] (0,0) grid[xstep=2,ystep=2] (\paperW,\paperH);

\foreach \spokeIndex [evaluate={\spoke=(\spokeIndex*2*\angle)}] in {0,...,\nSpokes}
{
	\pgfmathsetmacro\start{\spoke-\angle/2}
	\pgfmathsetmacro\stop{\spoke+\angle/2}
	\begin{scope}
	\clip (0,0) rectangle (\width, \height/2);
	\filldraw [fill=black, line width=0.001pt] (\cx, \cy) -- +({\radius*cos(\start)}, {\radius*sin(\start)}) arc[start angle=\start] -- cycle;
	\end{scope}
}
% HACK for some reason, clipping does *not* work when in SVG if it's the whole page
% the clip looks good in the PDF, but not all the spokes get clipped in the SVG.
% *however* it does clip properly in the SVG we clip half the page!
% since the CNC reads the PDF as an SVG, draw twice w/ the clip moved to force the SVG to get clipped
\foreach \spokeIndex [evaluate={\spoke=(\spokeIndex*2*\angle)}] in {0,...,\nSpokes}
{
	\pgfmathsetmacro\start{\spoke-\angle/2}
	\pgfmathsetmacro\stop{\spoke+\angle/2}
	\begin{scope}
	\clip (0, \height/2) rectangle (\width, \height);
	\filldraw [fill=black, line width=0.001pt] (\cx, \cy) -- +({\radius*cos(\start)}, {\radius*sin(\start)}) arc[start angle=\start] -- cycle;
	\end{scope}
}

% MAGIC draw a white circle so that it's easier to print on paper
%\filldraw[white] (\paperW/2, \paperH/2) circle (0.1pt);
\end{tikzpicture}%


\end{document}
\grid
